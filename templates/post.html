{% extends 'base.html' %}

{% block title %}文章 - 簡易部落格{% endblock %}

{% block content %}
  <div id="post-container">
    <p>載入中…</p>
  </div>

  <script>
  const postId = {{ post_id|tojson }};
    async function loadPost() {
      const res = await fetch(`/api/posts/${postId}`);
      if (!res.ok) {
        document.getElementById('post-container').innerHTML = '<p>讀取文章失敗</p>';
        return;
      }
      const p = await res.json();
      document.getElementById('post-container').innerHTML = `
        <article>
          <h1>${p.title}</h1>
          <p class="text-muted">作者：${p.author}</p>
          <div class="mt-3"><p style="white-space: pre-wrap;">${p.content}</p></div>
        </article>

        <div class="mt-4">
          <a class="btn btn-secondary" href="/">返回文章列表</a>
          <a class="btn btn-primary" href="/post/${p.id}/edit">編輯文章</a>
          <button class="btn btn-danger" id="btn-delete">刪除文章</button>
        </div>
      `;
      document.getElementById('btn-delete').addEventListener('click', async () => {
        if (!confirm('確定要刪除這篇文章嗎？')) return;
        const del = await fetch(`/api/posts/${postId}`, { method: 'DELETE' });
        if (del.ok) {
          alert('已刪除');
          window.location.href = '/';
        } else {
          alert('刪除失敗');
        }
      });
    }
    loadPost();
  </script>

{% endblock %}
